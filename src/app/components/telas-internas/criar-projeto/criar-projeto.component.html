<app-sidebar></app-sidebar>

<div class="container">
  <form [formGroup]="formProjeto" (ngSubmit)="onSubmit()">
    <div class="card">
      <div class="card-body">
        <div class="container-centralizado">

          <h3>{{ modoEdicao ? "Editar Projeto" : "Criar Projeto" }}</h3>
          <div class="linha"></div>

          <!-- 
               INFORMAÇÕES DO PROJETO
           -->
          <h4 class="section-title">Informações do Projeto</h4>
          

          <div class="mb-3">
            <label for="nomeDoProjeto" class="form-label">Nome do Projeto</label>
            <input
              id="nomeDoProjeto"
              type="text"
              class="form-control"
              formControlName="nomeDoProjeto"
              placeholder="Digite o nome do projeto"
            />
          </div>

          <div class="mb-3">
            <label for="descricao" class="form-label">Descrição</label>
            <textarea
              id="descricao"
              class="form-control"
              formControlName="descricao"
              placeholder="Digite a descrição do projeto"
              
              rows="2"
            ></textarea>
          </div>

          <div class="mb-3">
            <label for="periodo" class="form-label" >Período</label>
            <select id="periodo" class="form-control" formControlName="periodo">
               <option value="" disabled>Selecione a área de atuação</option>
              <option *ngFor="let p of periodosDisponiveis" [value]="p">
                {{ p }}
              </option>
            </select>
          </div>

          <!--
               DATAS
          -->
          <h4 class="section-title">Datas</h4>

          <div class="mb-3">
            <label class="form-label" for="dataInicioProjeto">Data de Início</label>
            <input
              id="dataInicioProjeto"
              type="date"
              class="form-control"
              formControlName="dataInicioProjeto"
            />
          </div>

          <div class="mb-3">
            <label class="form-label" for="dataFinalProjeto">Data Final</label>
            <input
              id="dataFinalProjeto"
              type="date"
              class="form-control"
              formControlName="dataFinalProjeto"
            />
          </div>

          <!-- 
               RELACIONAMENTOS
           -->
          <h4 class="section-title">Relacionamentos</h4>

          <!-- ÁREA DE ATUAÇÃO -->
          <div class="mb-3">
            <label for="areaDeAtuacao" class="form-label">Área de Atuação</label>

            <ng-container *ngIf="!modoEdicao; else editarArea">
              <input
                id="areaDeAtuacao"
                type="text"
                class="form-control"
                [value]="formProjeto.get('areaDeAtuacao')?.value?.nome || 'Carregando...'"
                readonly
              />
            </ng-container>

            <ng-template #editarArea>
              <select
                id="areaDeAtuacao"
                class="form-control"
                formControlName="areaDeAtuacao"
                (change)="onAreaDeAtuacaoChange()"
              >
                <option [ngValue]="null" disabled>Selecione a área</option>
                <option *ngFor="let area of areasDeAtuacao" [ngValue]="area">
                  {{ area.nome }}
                </option>
              </select>
            </ng-template>
          </div>

          <!-- MENTOR -->
          <div class="mb-3">
            <label class="form-label" for="mentor">Mentor</label>
            <div class="d-flex">
              <input
                id="mentor"
                type="text"
                class="form-control"
                [value]="formProjeto.get('mentor')?.value?.nome || ''"
                readonly
              />
              <button type="button" class="btn btn-primary ms-2" (click)="abrirModalMentor()">
                Selecionar
              </button>
            </div>
          </div>

          <!-- GRUPO -->
          <div class="mb-3">
            <label class="form-label" for="grupo">Grupo</label>

            <ng-container *ngIf="!modoEdicao; else editarGrupo">
              <input
                id="grupo"
                type="text"
                class="form-control"
                readonly
                [value]="formProjeto.get('grupo')?.value?.nome || 'Carregando...'"
              />
            </ng-container>

            <ng-template #editarGrupo>
              <select id="grupo" class="form-control" formControlName="grupo">
                <option [ngValue]="null" disabled>Selecione o grupo</option>
                <option *ngFor="let grupo of grupos" [ngValue]="grupo">
                  {{ grupo.nome }}
                </option>
              </select>
            </ng-template>
          </div>

          <!-- PROFESSORES -->
          <h4 class="section-title">Professores</h4>

          <div *ngIf="professoresSelecionados.length > 0" class="mb-2">
            <span
              *ngFor="let professor of professoresSelecionados"
              class="badge bg-primary me-1"
              style="cursor: pointer;"
              (click)="toggleProfessorSelecao(professor)"
            >
              {{ professor.nome }} ✕
            </span>
          </div>

          <div class="mb-3">
            <input
              class="form-control"
              placeholder="Pesquisar professores"
              (input)="pesquisarProfessores($event)"
            />
          </div>

          <ul class="list-group mb-3">
            <li
              class="list-group-item"
              *ngFor="let professor of professoresFiltrados; trackBy: trackByProfessorId"
              [class.active]="isProfessorSelecionado(professor)"
              (click)="toggleProfessorSelecao(professor)"
              style="cursor: pointer;"
            >
              {{ professor.nome }}
            </li>

            <li *ngIf="professoresFiltrados.length === 0" class="list-group-item text-center">
              Nenhum professor encontrado.
            </li>
          </ul>

        </div>
      </div>

      <!-- FOOTER -->
      <div class="card-footer d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" (click)="voltar()">Voltar</button>

        <button type="submit" class="btn btn-primary" [disabled]="formProjeto.invalid || carregando">
          <span *ngIf="!carregando">
            {{ modoEdicao ? "Atualizar Projeto" : "Salvar Projeto" }}
          </span>
          <span *ngIf="carregando">Salvando...</span>
        </button>
      </div>
    </div>
  </form>
</div>
