<app-sidebar></app-sidebar>

<div class="container">
  <form [formGroup]="formProjeto" (ngSubmit)="onSubmit()">
    <div class="card">
      <div class="card-body">
        <div class="container-centralizado">
          <h3>{{ modoEdicao ? "Editar Projeto" : "Criar Projeto" }}</h3>
          <div class="linha"></div>

          <h4 class="section-title">Informações do Projeto</h4>

          <div class="mb-3">
            <label for="nomeDoProjeto" class="form-label"
              >Nome do Projeto</label
            >
            <input
              id="nomeDoProjeto"
              type="text"
              class="form-control"
              formControlName="nomeDoProjeto"
              placeholder="Digite o nome do projeto"
            />
          </div>

          <div class="mb-3">
            <label for="descricao" class="form-label">Descrição</label>
            <textarea
              id="descricao"
              class="form-control"
              formControlName="descricao"
              placeholder="Digite a descrição do projeto"
              rows="2"
            ></textarea>
          </div>

          <div class="mb-3">
            <label for="periodo" class="form-label">Período</label>
            <select id="periodo" class="form-control" formControlName="periodo">
              <option value="" disabled>Selecione o período</option>
              <option *ngFor="let p of periodosDisponiveis" [value]="p">
                {{ p }}
              </option>
            </select>
          </div>

          <h4 class="section-title">Datas</h4>

          <div class="mb-3">
            <label class="form-label" for="dataInicioProjeto"
              >Data de Início</label
            >
            <input
              id="dataInicioProjeto"
              type="date"
              class="form-control"
              formControlName="dataInicioProjeto"
            />
          </div>

          <div class="mb-3">
            <label class="form-label" for="dataFinalProjeto">Data Final</label>
            <input
              id="dataFinalProjeto"
              type="date"
              class="form-control"
              formControlName="dataFinalProjeto"
            />
          </div>

          <h4 class="section-title">Relacionamentos</h4>

          <div class="mb-3">
            <label for="areaDeAtuacao" class="form-label"
              >Área de Atuação</label
            >

            <ng-container *ngIf="!modoEdicao; else editarArea">
              <input
                id="areaDeAtuacao"
                type="text"
                class="form-control"
                [value]="
                  formProjeto.get('areaDeAtuacao')?.value?.nome ||
                  'Carregando...'
                "
                readonly
              />
            </ng-container>

            <ng-template #editarArea>
              <select
                id="areaDeAtuacao"
                class="form-control"
                formControlName="areaDeAtuacao"
                (change)="onAreaDeAtuacaoChange()"
              >
                <option [ngValue]="null" disabled>Selecione a área</option>
                <option *ngFor="let area of areasDeAtuacao" [ngValue]="area">
                  {{ area.nome }}
                </option>
              </select>
            </ng-template>
          </div>

          <div class="mb-3">
            <label class="form-label" for="mentor">Mentor</label>
            <div class="d-flex">
              <input
                id="mentor"
                type="text"
                class="form-control"
                [value]="formProjeto.get('mentor')?.value?.nome || ''"
                readonly
              />
              <button
                type="button"
                class="btn btn-primary ms-2"
                (click)="abrirModalMentor()"
              >
                Selecionar
              </button>
            </div>
          </div>

          <div class="modal-overlay" *ngIf="modalAberto">
            <div class="modal-box">
              <h3>Selecionar Mentor</h3>
              <div class="linha"></div>

              <input
                type="text"
                class="modal-input"
                placeholder="Pesquisar mentor..."
                (input)="filtrarMentoresModal($event)"
              />

              <ul class="mentor-list">
                <li
                  class="mentor-item"
                  *ngFor="let mentor of mentoresFiltradosModal"
                  (click)="selecionarMentor(mentor)"
                >
                  <strong>{{ mentor.nome }}</strong
                  ><br />
                  <small>{{ mentor.email }}</small>
                </li>
              </ul>

              <div style="text-align: right; margin-top: 20px">
                <button class="btn-fechar" (click)="fecharModalMentor()">
                  Fechar
                </button>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="grupo">Grupo</label>

            <ng-container *ngIf="!modoEdicao; else editarGrupo">
              <input
                id="grupo"
                type="text"
                class="form-control"
                readonly
                [value]="
                  formProjeto.get('grupo')?.value?.nome || 'Carregando...'
                "
              />
            </ng-container>

            <ng-template #editarGrupo>
              <select id="grupo" class="form-control" formControlName="grupo">
                <option [ngValue]="null" disabled>Selecione o grupo</option>
                <option *ngFor="let grupo of grupos" [ngValue]="grupo">
                  {{ grupo.nome }}
                </option>
              </select>
            </ng-template>
          </div>

          <div class="mb-3">
            <label class="form-label">Professor(es) Responsável(is)</label>

            <input
              type="text"
              class="form-control"
              [value]="nomesProfessoresFormatados"
              readonly
              style="background-color: #e9ecef"
            />

            <small class="text-muted">
              *Definido automaticamente com base no seu Grupo.
            </small>
          </div>
        </div>
      </div>

      <div class="card-footer d-flex justify-content-between">
        <button type="button" class="btn btn-secondary" (click)="voltar()">
          Voltar
        </button>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="formProjeto.invalid || carregando"
        >
          <span *ngIf="!carregando">
            {{ modoEdicao ? "Atualizar Projeto" : "Salvar Projeto" }}
          </span>
          <span *ngIf="carregando">Salvando...</span>
        </button>
      </div>
    </div>
  </form>
</div>
