<app-sidebar></app-sidebar>

<div class="cadastro-container">
  <div class="form-box">
    <form [formGroup]="formProjeto" (ngSubmit)="onSubmit()">
      <div class="form-scroll-content">

        <div class="form-step">
          <h2>{{ modoEdicao ? "Editar Projeto" : "Criar Projeto" }}</h2>

          <!-- NOME DO PROJETO -->
          <label for="nomeDoProjeto">Nome do Projeto</label>
          <input
            id="nomeDoProjeto"
            type="text"
            formControlName="nomeDoProjeto"
            placeholder="Digite o nome do projeto"
          />

          <!-- DESCRIÇÃO -->
          <label for="descricao">Descrição</label>
          <textarea 
            id="descricao" 
            formControlName="descricao"
            placeholder="Digite a descrição do projeto"
          ></textarea>

          <!-- PERÍODO -->
          <label for="periodo">Período</label>
          <select id="periodo" formControlName="periodo">
            <option [ngValue]="null" disabled>Selecione o período</option>
            <option *ngFor="let p of periodosDisponiveis" [value]="p">
              {{ p }}
            </option>
          </select>
        </div>

        
        <div class="form-step">
          <h3>Datas</h3>

          <label for="dataInicioProjeto">Data de Início</label>
          <input id="dataInicioProjeto" type="date" formControlName="dataInicioProjeto"/>

          <label for="dataFinalProjeto">Data Final</label>
          <input id="dataFinalProjeto" type="date" formControlName="dataFinalProjeto"/>
        </div>

        
        <div class="form-step">
          <h3>Relacionamentos</h3>

          <!-- ÁREA DE ATUAÇÃO -->
          <label for="areaDeAtuacao">Área de Atuação</label>

        
          <div *ngIf="!modoEdicao">
            <input
              id="areaDeAtuacao"
              type="text"
              class="form-control-readonly"
              [value]="formProjeto.get('areaDeAtuacao')?.value?.nome || 'Carregando...'"
              readonly
            />
          </div>

          
          <div *ngIf="modoEdicao">
            <select id="areaDeAtuacao" formControlName="areaDeAtuacao" (change)="onAreaDeAtuacaoChange()">
              <option [ngValue]="null" disabled>Selecione a área</option>
              <option *ngFor="let area of areasDeAtuacao" [ngValue]="area">
                {{ area.nome }}
              </option>
            </select>
          </div>

          <!-- MENTOR -->
          <div class="mb-3">
            <label for="mentor" class="form-label">Mentor</label>

            <div class="d-flex">
              <input
                id="mentor"
                type="text"
                [value]="formProjeto.get('mentor')?.value?.nome || ''"
                placeholder="Selecione um mentor"
                readonly
              />

              <button type="button" class="btn-selecionar ms-2" (click)="abrirModalMentor()">
                Selecionar
              </button>
            </div>
          </div>

          <!-- MODAL MENTOR -->
          <div class="modal-overlay" *ngIf="modalAberto">
            <div class="modal-box">

              <h3>Selecionar Mentor</h3>

             <div class="modal-filtros">
              <input 
                type="text"
                placeholder="Pesquisar mentor..."
                class="modal-input"
                (input)="filtrarMentoresModal($event)"
                [(ngModel)]="filtroNome"
              />

              <select class="modal-input" [(ngModel)]="filtroArea" (change)="filtrarMentoresModal()">
                <option value="">Todas as áreas</option>
                <option *ngFor="let area of areasDeAtuacao" [value]="area.nome">
                  {{ area.nome }}
                </option>
              </select>
              </div>

              <ul class="mentor-list">
                <li
                  *ngFor="let mentor of mentoresFiltradosModal"
                  (click)="selecionarMentor(mentor)"
                  class="mentor-item"
                >
                  <div><strong>Nome:</strong> {{ mentor.nome }}</div>
                  <div><strong>Email:</strong> {{ mentor.email }}</div>
                  <div><strong>Telefone:</strong> {{ mentor.telefone }}</div>
                  <div *ngIf="mentor.formacaoDoMentor">
                    <strong>Formação:</strong> {{ mentor.formacaoDoMentor }}
                  </div>
                  <div><strong>Área:</strong> {{ mentor.areaDeAtuacao.nome }}</div>
                </li>

                <li *ngIf="mentoresFiltradosModal.length === 0" class="mentor-item no-results">
                  Nenhum mentor encontrado.
                </li>
              </ul>

              <div class="modal-footer-row">
              <button class="btn-fechar" (click)="fecharModalMentor()">Fechar</button>
            </div>
          </div>
          </div>

          <!-- GRUPO -->
          <label for="grupo">Grupo</label>

          <div *ngIf="!modoEdicao">
            <input
              id="grupo"
              type="text"
              class="form-control-readonly"
              [value]="formProjeto.get('grupo')?.value?.nome || 'Carregando...'"
              readonly
            />
          </div>

          <div *ngIf="modoEdicao">
            <select id="grupo" formControlName="grupo">
              <option [ngValue]="null" disabled>Selecione o grupo</option>
              <option *ngFor="let grupo of grupos" [ngValue]="grupo">
                {{ grupo.nome }}
              </option>
            </select>
          </div>

          <!-- PROFESSORES -->
          <label for="professores-ids">Selecione os professores</label>
          
          <div *ngIf="professoresSelecionados.length > 0" class="professores-selecionados-container">
            <span 
              *ngFor="let professor of professoresSelecionados; let i = index"
              class="badge-professor-selecionado"
            >
              {{ professor.nome }}
              <button
                type="button"
                (click)="toggleProfessorSelecao(professor)"
                class="btn-remover-professor"
              >
              </button>
            </span>
          </div>

          <div class="professores">
            <input
              class="swall2-input"
              id="input-professores"
              placeholder="Digite os nomes dos professores"
              (input)="pesquisarProfessores($event)"
            />
          </div>

          <div class="list-professores">
            <ul class="professores-list-container">
              <li 
                *ngFor="let professor of professoresFiltrados; trackBy: trackByProfessorId"
                (click)="toggleProfessorSelecao(professor)"
                [class.professor-selecionado]="isProfessorSelecionado(professor)"
              >
                {{ professor.nome }}
              </li>
            </ul>
            
            <div *ngIf="professoresFiltrados.length === 0" class="no-results">
              Nenhum professor encontrado.
            </div>
          </div>

          <!-- BOTÕES -->
          <div class="form-buttons-container">
            <div class="buttons-row">
              <button type="button" class="btn-back" (click)="voltar()">
                Voltar
              </button>

              <button type="submit" [disabled]="formProjeto.invalid || carregando">
                <span *ngIf="!carregando">
                  {{ modoEdicao ? "Atualizar Projeto" : "Salvar Projeto" }}
                </span>

                <span *ngIf="carregando">
                  Salvando...
                </span>
              </button>
            </div>
          </div>

        </div>

      </div>
    </form>
  </div>
</div>
